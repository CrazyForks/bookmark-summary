Title: ä»Pythonå¼‚æ­¥ç¼–ç¨‹çš„å‰–æä¸­ä½“ä¼šæ™ºèƒ½ä½“å¹¶å‘ç¼–ç¨‹æ¨¡å¼ - é“è•¾çš„ä¸ªäººåšå®¢

URL Source: https://zhangtielei.com/posts/blog-bridgic-concurrency-mode.html

Published Time: Mon, 22 Dec 2025 14:57:40 GMT

Markdown Content:
[é¦–é¡µ](https://zhangtielei.com/)>[AIæŠ€æœ¯](https://zhangtielei.com/posts/ai.html)>æ­£æ–‡

ä»Pythonå¼‚æ­¥ç¼–ç¨‹çš„å‰–æä¸­ä½“ä¼šæ™ºèƒ½ä½“å¹¶å‘ç¼–ç¨‹æ¨¡å¼ 
2025-12-21
--------------------------------------

* * *

ä»Šå¤©æˆ‘ä»¬è®¨è®ºä¸€ä¸ªè·ŸPythonå¼‚æ­¥ç¼–ç¨‹æœ‰å…³çš„é—®é¢˜ã€‚é—®é¢˜æºäºæˆ‘ä»¬åœ¨å¼€å‘[Bridgic](https://docs.bridgic.ai/)é¡¹ç›®æ—¶ç¢°åˆ°çš„ä¸€ä¸ªåŸºç¡€ç¼–ç¨‹é—®é¢˜ï¼šè¢«è°ƒåº¦æ‰§è¡Œçš„agentåº”è¯¥è¿è¡Œåœ¨ä¸€ä¸ªä»€ä¹ˆæ ·çš„çº¿ç¨‹ç¯å¢ƒä¸Šï¼Ÿ

è¿™ä¸ªé—®é¢˜å¦‚æ­¤åŸºç¡€ï¼Œç”šè‡³å¯èƒ½æ˜¯å¼€å‘ä»»ä½•ä¸€ä¸ªå¤æ‚ç³»ç»Ÿæ—¶ç¬¬ä¸€æ­¥å°±åº”è¯¥è¢«è€ƒè™‘çš„é—®é¢˜ã€‚æ™ºèƒ½ä½“çš„è°ƒåº¦æ‰§è¡Œï¼Œä¸ºè¿™ä¸ªé—®é¢˜çš„è®¨è®ºæä¾›äº†ä¸€ä¸ªç»ä½³çš„åœºæ™¯ï¼Œå¯¹äºæˆ‘ä»¬æ„å»ºå…¶ä»–ç³»ç»Ÿä¹Ÿå…·æœ‰é‡è¦çš„å‚è€ƒæ„ä¹‰ã€‚

æœ¬æ–‡å›´ç»•ä»¥ä¸‹å››éƒ¨åˆ†å†…å®¹å±•å¼€ï¼š

*   å¹¶å‘ (concurrency) å’Œå¹¶è¡Œ (parallelism) çš„åŒºåˆ«ã€‚
*   å…¸å‹çš„ä»»åŠ¡ç±»å‹ï¼šI/O-boundå’ŒCPU-boundï¼Œä»¥åŠGILçš„å½±å“ã€‚
*   Bridgicçš„å¹¶å‘æ¨¡å¼ (Concurrency Mode) è®¾è®¡æ€è·¯ã€‚
*   å¹¶å‘æ¨¡å¼å¯¹Bridgicæ¡†æ¶å±‚å®ç°çš„å½±å“ã€‚

> ğŸ’¾ **Bridgicï¼šä¸€ä¸ªæ”¯æŒåŠ¨æ€æ‹“æ‰‘çš„AIæ™ºèƒ½ä½“æ¡†æ¶ï¼š**
> 
> [ç‚¹å‡»è¿™é‡Œä¸‹è½½æºç  âœ https://github.com/bitsky-tech/bridgic](https://github.com/bitsky-tech/bridgic)

### å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«

æˆ‘ä»¬çš„è®¨è®ºä»¥Bridgicçš„ç¼–ç¨‹åœºæ™¯ä½œä¸ºèµ·ç‚¹ã€‚Bridgicæ˜¯ä¸€ä¸ªagentæ¡†æ¶ï¼Œå®ƒéœ€è¦è°ƒåº¦å¤šä¸ªagentåŒæ—¶è¿è¡Œã€‚äºæ˜¯ï¼Œå°±åœ¨ä¸¤ä¸ªå±‚é¢ä¸Šäº§ç”Ÿäº†å¹¶å‘æ‰§è¡Œçš„éœ€æ±‚ï¼š

*   **ç¬¬ä¸€ï¼ŒåŒä¸€ä¸ªagentå†…éƒ¨çš„å¹¶å‘åˆ†æ”¯ä¹‹é—´éœ€è¦å¹¶å‘**ã€‚åœ¨ä¸€ä¸ªagentå†…éƒ¨ï¼Œå¯èƒ½ç¼–æ’å‡ºå¹¶å‘çš„æ‰§è¡Œåˆ†æ”¯ï¼Œæ¯”å¦‚åŠ¨æ€å­ä»»åŠ¡æ‹†åˆ†ï¼Œæˆ–è€…å¹¶å‘è°ƒç”¨å·¥å…·ã€‚å¤„äºä¸åŒå¹¶å‘åˆ†æ”¯ä¸Šçš„workerï¼Œå®ƒä»¬çš„æ‰§è¡Œä¸åº”è¯¥ç›¸äº’é˜»å¡ï¼Œå¦åˆ™å¹¶å‘åˆ†æ”¯æœ¬èº«å°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ã€‚
*   **ç¬¬äºŒï¼Œä¸åŒagentä¹‹é—´çš„æ‰§è¡Œéœ€è¦å¹¶å‘**ã€‚æ•´ä¸ªç³»ç»Ÿéœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªagentçš„è°ƒåº¦è¿è¡Œï¼Œå› æ­¤ä»»ä½•ä¸€ä¸ªagentçš„æ‰§è¡Œéƒ½ä¸åº”è¯¥é˜»å¡å…¶ä»–agentçš„æ‰§è¡Œã€‚

å¦ä¸€æ–¹é¢ï¼Œè®¡ç®—æœºç³»ç»Ÿå¯¹äºå¹¶å‘æ‰§è¡Œèƒ½åŠ›çš„æ”¯æŒï¼Œä¹Ÿåˆ†æˆäº†ä¸¤ä¸ªå±‚é¢ï¼š

*   ç¬¬ä¸€ä¸ªå±‚é¢æ˜¯concurrencyï¼Œä¸­æ–‡ç¿»è¯‘è¿‡æ¥æ˜¯ã€Œå¹¶å‘ã€ã€‚å®ƒæŒ‡çš„æ˜¯ä¸€ä¸ªç³»ç»Ÿå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œå¤šä¸ªä»»åŠ¡ä¹‹é—´å¯ä»¥ç©¿æ’æ‰§è¡Œï¼Œåˆ†æ—¶å¤ç”¨ã€‚ä½†ä»»ä¸€æ—¶åˆ»ï¼Œç³»ç»Ÿä»ç„¶åªéœ€è¦å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚
*   ç¬¬äºŒä¸ªå±‚é¢æ˜¯parallelismï¼Œä¸€èˆ¬ä¸­æ–‡ç¿»è¯‘ä¸ºã€Œå¹¶è¡Œã€ã€‚å®ƒæŒ‡çš„æ˜¯ä¸€ä¸ªç³»ç»Ÿå¯ä»¥åœ¨åŒä¸€æ—¶åˆ»åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚

å¥½ï¼Œä»ç°åœ¨å¼€å§‹ï¼Œä¸ºäº†è¡¨è¾¾ä¸Šçš„å‡†ç¡®ã€æ— æ­§ä¹‰ï¼Œæˆ‘ä»¬å°±**ç”¨ã€Œå¹¶å‘ã€æ¥è¡¨ç¤ºconcurrencyï¼Œç”¨ã€Œå¹¶è¡Œã€æ¥è¡¨ç¤ºparallelism**ã€‚è¿™ä¸¤è€…å¯ä»¥ç”¨ä¸€ä¸ªæ¯”å–»æ¥å½¢è±¡åœ°åŒºåˆ†ï¼š

*   å¹¶å‘ï¼Œç›¸å½“äºä¸€ä¸ªå¨å¸ˆåŒæ—¶ç‚’å¤šç›˜èœã€‚å¹²æ´»å„¿çš„åªæœ‰ä¸€ä¸ªäººï¼Œä»–å¾—å…¼é¡¾å¤šä¸ªç‚’é”…ã€‚
*   å¹¶è¡Œï¼Œç›¸å½“äºå¤šä¸ªå¨å¸ˆåŒæ—¶ç‚’å¤šç›˜èœã€‚å¹²æ´»å„¿çš„äººå¤šäº†ï¼Œä»–ä»¬å°±å¯ä»¥å„å¹²å„çš„ï¼ŒçœŸæ­£åœ°äº’ä¸å½±å“ã€‚æŒ‰ç…§ã€Š[æŠ€æœ¯å˜è¿ä¸­çš„å˜ä¸ä¸å˜ï¼šå¦‚ä½•æ›´å¿«åœ°ç”Ÿæˆtokenï¼Ÿ](https://mp.weixin.qq.com/s/BPnX0zOJr8PLAxlvKQBsxw)ã€‹ä¸€æ–‡ä¸­å¯¹ç³»ç»Ÿå»ºæ¨¡çš„æ¦‚å¿µï¼Œå¤šä¸ªå¨å¸ˆå°±ç›¸å½“äºå¤šä¸ªæœåŠ¡é€šé“ã€‚

ç”±äºã€Œä¸€ä¸ªå¨å¸ˆã€æ˜¯ã€Œå¤šä¸ªå¨å¸ˆã€çš„ç‰¹ä¾‹ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬è¯´ä¸€ä¸ªç³»ç»Ÿæ˜¯å¹¶è¡Œçš„ï¼Œé‚£ä¹ˆä¹Ÿæ„å‘³ç€å®ƒæ˜¯å¹¶å‘çš„ã€‚ä½†åè¿‡æ¥å°±æ˜¾ç„¶ä¸æˆç«‹ã€‚

ç°åœ¨é—®é¢˜æ¥äº†ï¼Œå‰é¢å¯¹äºè°ƒåº¦å¤šä¸ªagentå¹¶å‘æ‰§è¡Œçš„éœ€æ±‚ï¼ˆåŒ…å«agentå†…éƒ¨å’Œagentä¹‹é—´ä¸¤ä¸ªå±‚é¢ï¼‰ï¼Œæ˜¯åªéœ€è¦ç³»ç»Ÿå…·å¤‡å¹¶å‘èƒ½åŠ›å°±å¤Ÿäº†å‘¢ï¼Ÿè¿˜æ˜¯å¿…é¡»æä¾›å¹¶è¡Œèƒ½åŠ›ï¼Ÿ

è¦å‡†ç¡®å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æè¢«è°ƒåº¦çš„ä»»åŠ¡çš„æ€§è´¨ã€‚æˆ‘ä»¬ä¸‹ä¸€å°èŠ‚å±•å¼€ã€‚

### I/O-boundå’ŒCPU-boundï¼Œä»¥åŠGILçš„å½±å“

æŒ‰ç…§è½¯ä»¶ç¼–ç¨‹çš„æœ¯è¯­ï¼ˆä¸ä»…é™äºPythonä¸–ç•Œï¼‰ï¼Œè½¯ä»¶ä»»åŠ¡é€šå¸¸ä¼šè¢«åˆ†æˆä¸¤ä¸ªå…¸å‹çš„ç±»å‹ï¼š

*   **I/O-bound task**ï¼šå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰å¾…è¾“å…¥è¾“å‡ºçš„ä»»åŠ¡ã€‚è¿™ç±»ä»»åŠ¡å ç”¨CPUèµ„æºéå¸¸å°‘ã€‚åœ¨å®ƒç­‰å¾…I/Oçš„è¿‡ç¨‹ä¸­ï¼ŒCPUæ˜¯ç©ºé—²çš„ã€‚
*   **CPU-bound task**ï¼šå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨æ‰§è¡ŒæŸç§è®¡ç®—çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—å¯†é›†å‹çš„ä»»åŠ¡ã€‚è¿™ç±»ä»»åŠ¡å¯¹CPUèµ„æºçš„æ¶ˆè€—éå¸¸å¤§ã€‚

é€šå¸¸æ¥è¯´ï¼Œåœ¨äº’è”ç½‘ä¸šåŠ¡åœºæ™¯ä¸‹ï¼ŒI/O-bound taskæ˜¯æ›´å¸¸è§çš„ã€‚è¿™äº›ä»»åŠ¡éœ€è¦ç­‰å¾…çš„I/Oæ“ä½œä¸€èˆ¬æ˜¯æŒ‡ç½‘ç»œè¯·æ±‚ã€‚è€ŒCPU-bound taskçš„å¸¸è§ä¾‹å­åˆ™åŒ…æ‹¬ï¼šæœºå™¨å­¦ä¹ è®­ç»ƒä»»åŠ¡ã€æ•°å­¦è®¡ç®—ä»»åŠ¡ã€æ•°æ®å¤„ç†ä»»åŠ¡ã€å›¾ç‰‡/è§†é¢‘å¤„ç†ä»»åŠ¡ã€åŠ å¯†/è§£å¯†ä»»åŠ¡ç­‰ç­‰ã€‚

æœ‰äººå¯èƒ½ä¼šè¯´ï¼ŒæŠŠè½¯ä»¶ä»»åŠ¡åˆ†æˆI/O-bound taskå’ŒCPU-bound taskä¸¤ç±»ï¼Œä¼¼ä¹ä¸å¤ªç¬¦åˆMECE[1]åŸåˆ™ï¼ˆç›¸äº’ç‹¬ç«‹ï¼Œå®Œå…¨ç©·å°½ï¼‰ã€‚è‡³å°‘åº”è¯¥è¿˜æœ‰ç¬¬ä¸‰ç±»ä»»åŠ¡ï¼Œå®ƒä»¬æ—¢ä¸æ¶ˆè€—å¤§é‡CPUï¼Œä¹Ÿæ²¡æœ‰é•¿æ—¶é—´ç­‰å¾…çš„I/Oæ“ä½œã€‚ä¸¥æ ¼æ¥è¯´ï¼Œç¡®å®å¦‚æ­¤ã€‚ä½†è¿™ç±»ä»»åŠ¡ç”±äºèµ„æºæ¶ˆè€—å¾ˆå°ï¼Œæ‰€ä»¥å¯¹ç³»ç»Ÿçš„å¹¶å‘æ‰§è¡Œèƒ½åŠ›æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„è¦æ±‚ï¼Œåœ¨è®¨è®ºä¸­ä¹Ÿå°±æ— è¶³è½»é‡ã€‚

ä½†æ˜¯ï¼ŒI/O-bound taskè¿™ä¸€ç±»ä»»åŠ¡å´æ˜¯éœ€è¦è¿›ä¸€æ­¥åˆ†ç±»çš„ã€‚å®ƒåˆ†æˆä¸¤ç±»ï¼š

*   **Blocking I/O task**ï¼šä¹Ÿç§°ä¸ºsynchronous I/O taskï¼ŒæŒ‡çš„æ˜¯è¿™ç±»ä»»åŠ¡å†…éƒ¨è°ƒç”¨äº†åŒæ­¥çš„I/Oæ“ä½œï¼Œä¼šé˜»å¡ä½è°ƒç”¨å®ƒçš„çº¿ç¨‹ã€‚åœ¨å®é™…ä¸­è¿™ç§æƒ…å†µæ˜¯å¯èƒ½å‘ç”Ÿçš„ï¼Œæ¯”å¦‚ä½ å¼•ç”¨äº†ä¸€äº›è€çš„ä»£ç åº“ï¼Œè€Œè¿™äº›ä»£ç åº“ä¸æ”¯æŒå¼‚æ­¥I/Oã€‚
*   **Non-Blocking I/O task**ï¼šä¹Ÿç§°ä¸ºasynchronous I/O taskï¼ŒæŒ‡çš„æ˜¯è¿™äº›ä»»åŠ¡å†…éƒ¨åªè°ƒç”¨äº†å¼‚æ­¥çš„I/Oæ“ä½œï¼Œå› æ­¤åŸåˆ™ä¸Šä¸ä¼šé˜»å¡ä½è°ƒç”¨çº¿ç¨‹ã€‚åœ¨Pythonçš„è¯­å¢ƒä¸‹ï¼Œå¼‚æ­¥I/Oå¾ˆå¯èƒ½æ˜¯åŸºäºasyncioå®ç°å‡ºæ¥çš„ã€‚å› æ­¤ï¼Œnon-blocking I/O taskä¸­çš„å¤§éƒ¨åˆ†éƒ½åº”è¯¥æ˜¯**asyncio-aware**çš„ã€‚è‡³äºå‰©ä¸‹çš„å°‘éƒ¨åˆ†ä¸æ˜¯ç”¨asyncioå®ç°å‡ºæ¥çš„ï¼Œä½†ç¡®å®åˆæ˜¯non-blockingçš„ä»»åŠ¡ï¼Œå¹¶ä¸æ˜¯ä¸»æµã€‚å¯¹äºè¿™ç±»ä»»åŠ¡çš„å¤„ç†æ¶‰åŠåˆ°ä¸€äº›ç»†èŠ‚ï¼Œä½†æ ¹æ®blogæ–‡ç« â€œPython Asyncio Part 5 â€“ Mixing Synchronous and Asynchronous Codeâ€[2]åœ¨â€œUsing non-blocking IO and periodic pollingâ€è¿™ä¸€å°èŠ‚ç»™å‡ºçš„æ–¹æ³•ï¼Œè¿™ç±»ä»»åŠ¡å…¶å®å¯ä»¥å¾ˆå¿«å°è£…æˆä¸€ä¸ªasyncio-aware taskã€‚è¿™å…¶ä¸­æ¶‰åŠåˆ°çš„ç»†èŠ‚ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œç•¥è¿‡ä¸å±•å¼€è®¨è®ºã€‚æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒæ–‡æœ«çš„é“¾æ¥ã€‚

æ€»ä¹‹ï¼Œæ ¹æ®æˆ‘ä»¬å½“å‰å…³æ³¨çš„é‡ç‚¹ï¼ˆå¯¹å¹¶å‘æ‰§è¡Œèƒ½åŠ›çš„è¦æ±‚ï¼‰ï¼Œè½¯ä»¶ä»»åŠ¡å¯ä»¥åƒä¸‹é¢è¿™æ ·åˆ†ç±»ï¼š

*   **I/O-bound task**ï¼Œåˆåˆ†ä¸ºï¼š 
    *   **asyncio-aware task**ã€‚
    *   **Blocking I/O task**ï¼›

*   **CPU-bound task**ã€‚

[![Image 1: Software Task Taxonomy](https://zhangtielei.com/assets/images_bridgic_concurrency/task_taxonomy.png)](https://zhangtielei.com/assets/images_bridgic_concurrency/task_taxonomy.png)

ç°åœ¨æˆ‘ä»¬å¯ä»¥é€ä¸ªåˆ†æä¸€ä¸‹è¿™å‡ ç±»ä»»åŠ¡äº†ã€‚

é¦–å…ˆï¼Œå¯¹äºasyncio-aware taskï¼Œè‡ªç„¶æ˜¯ä½¿ç”¨asyncio[3]æ¥å®ç°å¹¶å‘èƒ½åŠ›æœ€åˆé€‚ã€‚asyncioæ˜¯Pythonçš„æ ‡å‡†åº“ï¼Œå®ƒæä¾›äº†ä½¿ç”¨`async/await`è¯­æ³•æ¥ç¼–å†™å¹¶å‘ä»£ç çš„èƒ½åŠ›ã€‚asyncioèƒŒåçš„æ€æƒ³æ˜¯ä½¿ç”¨event loopå’Œåç¨‹ (coroutine) ã€‚

è¯è¯´èµ·æ¥ï¼Œevent loopæ˜¯ç”±æ¥å·²ä¹…çš„ä¸€é¡¹æŠ€æœ¯äº†ï¼Œå±äºå¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œå…è®¸å¤šä¸ªtaskåœ¨å•çº¿ç¨‹ä¸Šåˆ†æ—¶å¤ç”¨CPUèµ„æºã€‚æœ€å¼€å§‹è¿™ç§æŠ€æœ¯åœ¨å®¢æˆ·ç«¯ï¼ˆiOSã€Androidï¼‰æˆ–webå‰ç«¯ç¼–ç¨‹ä¸­ä½¿ç”¨è¾ƒå¤šã€‚å› ä¸ºæ˜¯å¼‚æ­¥ç¼–ç¨‹ï¼Œæ‰€ä»¥æ—©æœŸä¸€èˆ¬éœ€è¦é€šè¿‡æ³¨å†Œcallbackæ¥è·å–ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œç¼–ç¨‹æ–¹å¼ç¹çï¼Œåœ¨æ—¶åºä¸Šçš„è¦æ±‚ä¹Ÿé«˜ï¼Œå­˜åœ¨æ¯”è¾ƒé«˜çš„ç¼–ç¨‹é—¨æ§›å’Œç»´æŠ¤é—¨æ§›ã€‚ä½†æ˜¯ï¼Œä¸€äº›ç°ä»£è¯­è¨€ï¼Œæ¯”å¦‚Pythonã€JavaScriptï¼Œåœ¨é…åˆäº†åç¨‹çš„æŠ€æœ¯å’Œ`async/await`è¯­æ³•ä¹‹åï¼ŒåŸºæœ¬æ¶ˆé™¤äº†callbackï¼Œè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ç±»ä¼¼åŒæ­¥ç¼–ç¨‹çš„æ–¹å¼æ¥å®ç°å¼‚æ­¥æ‰§è¡Œï¼Œå¤§å¤§é™ä½äº†ä½¿ç”¨é—¨æ§›ã€‚

ä½†ä»æ ¹æœ¬ä¸Šæ¥è¯´ï¼Œ**asyncioæ˜¯åœ¨å•ä¸€çº¿ç¨‹ä¸Šä»¥åç¨‹ä¸ºç²’åº¦å¤ç”¨CPUèµ„æºçš„ä¸€é¡¹æŠ€æœ¯ï¼Œå®ƒä¸ä¼šåˆ©ç”¨CPUå¤šæ ¸çš„è®¡ç®—èƒ½åŠ›**ã€‚åˆç”±äºasyncio-aware taskå±äºI/O-bound taskï¼Œè¿™ç±»ä»»åŠ¡å¯¹äºCPUçš„è®¡ç®—èµ„æºè¦æ±‚å¾ˆä½ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å°±è¶³ä»¥å¤„ç†å¤§é‡åç¨‹ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆevent loopæŠ€æœ¯å¾—ä»¥åœ¨æœåŠ¡ç«¯ç¼–ç¨‹ä¸­è¢«ä½¿ç”¨çš„åŸå› ï¼šå¤§é‡ä»»åŠ¡è¿è¡Œåœ¨å•çº¿ç¨‹ä¸Šï¼Œä½†å®ƒä»¬å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰å¾…I/Oæ“ä½œï¼ˆå¤„ç†ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œå³ä½¿åˆèµ·æ¥å¯¹äºCPUèµ„æºçš„æ¶ˆè€—ä¹Ÿä¸æ˜¯ç“¶é¢ˆã€‚Rediså°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æœåŠ¡ç«¯çš„ä¾‹å­ï¼Œä¸»è¦ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥åŒæ—¶å¤„ç†å¤§é‡è¯·æ±‚ï¼ˆè¯¦æƒ…å¯ä»¥å‚è§æˆ‘[ä¹‹å‰çš„æ–‡ç« ](https://mp.weixin.qq.com/s/5SzbrBMpq-JowLfvfWNY-g)ï¼‰ã€‚

è€Œå¯¹äºBlocking I/O taskæ¥è¯´ï¼Œæƒ…å†µå°±ä¸åŒäº†ã€‚è™½ç„¶è¿™ç±»ä»»åŠ¡å¯¹CPUèµ„æºæ¶ˆè€—ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯å®ƒç­‰å¾…I/Oçš„æ“ä½œæ˜¯ä¸ªåŒæ­¥æ“ä½œï¼Œå› æ­¤ä¼šé˜»å¡ä½è°ƒç”¨çº¿ç¨‹ã€‚å¦‚æœä»ç„¶ä½¿ç”¨å•çº¿ç¨‹event loopçš„æ–¹å¼æ¥æ‰§è¡Œæ­¤ç±»ä»»åŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠè¿™å”¯ä¸€çš„ä¸€ä¸ªçº¿ç¨‹é˜»å¡ä½ï¼Œå¯¼è‡´å…¶ä»–ä»»åŠ¡ä¹Ÿæ²¡æ³•æ‰§è¡Œã€‚å› æ­¤ï¼Œæ‰§è¡ŒBlocking I/O taskå°±éœ€è¦å¤šçº¿ç¨‹[4]ã€‚

å†çœ‹ä¸€ä¸‹CPU-bound taskã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œè¿™ç±»ä»»åŠ¡ä½¿ç”¨å¤šçº¿ç¨‹æ¥æ‰§è¡Œæœ¬æ¥æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯ï¼Œåœ¨Pythonç¯å¢ƒä¸‹ï¼Œç”±äºGIL (Global Interpreter Lock) çš„å­˜åœ¨ï¼ŒPythonå¯¹äºå¤šçº¿ç¨‹çš„å®ç°æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶[4]ï¼š

> In CPython, due to the Global Interpreter Lock, only one thread can execute Python code at once (even though certain performance-oriented libraries might overcome this limitation).
> 
> 
> è¯‘æ–‡ï¼šåœ¨CPythonä¸­ï¼Œç”±äºå­˜åœ¨å…¨å±€è§£é‡Šå™¨é”ï¼Œå› æ­¤åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡ŒPythonä»£ç ï¼ˆå°½ç®¡æŸäº›æ³¨é‡æ€§èƒ½çš„åº“èƒ½å¤Ÿå…‹æœè¿™ä¸€é™åˆ¶ï¼‰ã€‚

è¿™ä¸€é™åˆ¶å¯¼è‡´ï¼Œä½¿ç”¨Pythonçš„å¤šçº¿ç¨‹æ¥æ‰§è¡ŒCPU-bound taskå¹¶ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚

é™¤äº†ä»¥ä¸Šé™åˆ¶ï¼ŒPythonçš„å¤šçº¿ç¨‹è¿˜æ¶‰åŠåˆ°ä¸€äº›å…³é”®çš„ç»†èŠ‚ï¼š

*   å¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œï¼Œæ˜¯å¯ä»¥åœ¨æŒ‡ä»¤çº§åˆ«è¿›è¡Œåˆ‡æ¢çš„ã€‚ä½†ç”±äºGILçš„å½±å“ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹å†…åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œæ‰€ä»¥å¤šä¸ªçº¿ç¨‹ä¹‹é—´ä»ç„¶åªæ˜¯åˆ†æ—¶å¤ç”¨ã€‚æŒ‰ç…§ä¸Šä¸€å°èŠ‚çš„æ¦‚å¿µï¼Œè¿™å±äºå¹¶å‘çš„èŒƒç•´è€ŒéçœŸæ­£çš„å¹¶è¡Œï¼ˆå¯¹åº”åªæœ‰ä¸€ä¸ªå¨å¸ˆå¹²æ´»å„¿çš„æƒ…å¢ƒï¼‰ã€‚æ­£æ˜¯å› ä¸ºå¦‚æ­¤ï¼Œåœ¨Pythonä¸­ä½¿ç”¨å¤šçº¿ç¨‹æ‰§è¡ŒCPU-bound taskï¼Œä¸åŒçš„ä»»åŠ¡ä¹‹é—´å°±ä¼šäº‰æŠ¢CPUï¼Œç»“æœå°±æ˜¯è¿è¡Œé€Ÿåº¦å˜æ…¢ã€‚
*   Pythonä»3.14ç‰ˆæœ¬å¼€å§‹æ”¯æŒfree threading[5]ï¼ˆéœ€è¦æ˜¯ç‰¹æ®Šçš„free-threading buildç‰ˆæœ¬ï¼‰ã€‚è¿™æ˜¯ä¸€ç§å…¨æ–°çš„å¤šçº¿ç¨‹æœºåˆ¶ï¼Œå‰é¢GILå¸¦æ¥çš„é™åˆ¶å°±ä¸å­˜åœ¨äº†ï¼ŒPythonå¤šçº¿ç¨‹ä»æ­¤å¯ä»¥å®ç°çœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œã€‚ä¸è¿‡ç›®å‰è¿™ä¸ªç‰ˆæœ¬åœ¨ç”Ÿäº§ç¯å¢ƒè¿˜æ²¡æœ‰è¢«å¤§é‡ä½¿ç”¨ï¼Œå› æ­¤æˆ‘ä»¬åœ¨åé¢çš„è®¨è®ºä¸­å…ˆä¸è€ƒè™‘å®ƒã€‚
*   å¤§éƒ¨åˆ†I/Oæ“ä½œï¼ˆåŒ…æ‹¬æ–‡ä»¶è¯»å†™ã€ç½‘ç»œæ•°æ®æ”¶å‘ï¼‰éƒ½æ˜¯é€šè¿‡è°ƒç”¨nativeä»£ç å®ç°çš„ï¼Œå¹¶ä¸”ä¼šä¸»åŠ¨é‡Šæ”¾GILé”[2]ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œé˜»å¡å¼I/Oæ“ä½œçš„æ—¶å€™ï¼Œå®ƒä¸ä¼šé˜»å¡ä½åŒä¸€ä¸ªè¿›ç¨‹å†…çš„å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼ˆè™½ç„¶å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ä½ï¼‰ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œè™½ç„¶åœ¨ä¸€ä¸ªPythonè¿›ç¨‹å†…åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œä¸”ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªblocking I/Oä¼šé˜»å¡ä½å½“å‰çº¿ç¨‹ï¼Œä½†ä½¿ç”¨å¤šçº¿ç¨‹æ‰§è¡ŒBlocking I/O taskä¸€èˆ¬å´æ˜¯æ²¡é—®é¢˜çš„ï¼Œè¿™äº›taskä¹‹é—´ä¸ä¼šç›¸äº’é˜»å¡ã€‚

é‚£ä¹ˆï¼Œæ‰§è¡ŒCPU-bound taskæ€ä¹ˆåŠå‘¢ï¼Ÿç›®å‰æˆ‘ä»¬è®¤ä¸ºï¼Œåœ¨Pythonä¸­éœ€è¦ä½¿ç”¨å¤šè¿›ç¨‹æœºåˆ¶[6]ã€‚

ç°åœ¨å°ç»“ä¸€ä¸‹ï¼š

*   åœ¨ä¸è€ƒè™‘Pythoné«˜ç‰ˆæœ¬free threadingçš„æƒ…å†µä¸‹ï¼Œ**Pythonä¸­çš„asyncioå’Œå¤šçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªæœºåˆ¶éƒ½åªèƒ½æä¾›å¹¶å‘æ‰§è¡Œçš„èƒ½åŠ›**ï¼Œä»£ç æ‰§è¡Œåªæ˜¯åˆ†æ—¶å¤ç”¨ã€‚ä¸åŒçš„æ˜¯ï¼Œasyncioå¯¹äºCPUèµ„æºçš„å¤ç”¨ç²’åº¦æ˜¯åç¨‹ï¼Œè€Œå¤šçº¿ç¨‹ä¹‹é—´å¤ç”¨CPUèµ„æºçš„ç²’åº¦æ˜¯æŒ‡ä»¤ã€‚
*   **Pythonä¸­çš„å¤šè¿›ç¨‹æœºåˆ¶æ‰æä¾›çœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œèƒ½åŠ›**ã€‚

é‚£ä¹ˆï¼Œåœ¨Pythonç¯å¢ƒä¸‹ï¼Œå¯¹äºå‰é¢å…¸å‹çš„å‡ ç§ä»»åŠ¡ç±»å‹æ¥è¯´ï¼š

*   **asyncio-aware taskï¼Œåº”è¯¥ä½¿ç”¨asyncioæ¥å®ç°å¹¶å‘ã€‚**
*   **Blocking I/O taskï¼Œä¸€èˆ¬ä½¿ç”¨å¤šçº¿ç¨‹æ¥å®ç°å¹¶å‘ã€‚**
*   **CPU-bound taskï¼Œåº”è¯¥ä½¿ç”¨å¤šè¿›ç¨‹æ¥å®ç°çœŸæ­£çš„å¹¶è¡Œã€‚**

### Bridgicçš„å¹¶å‘æ¨¡å¼è®¾è®¡æ€è·¯

å¥½ï¼Œç°åœ¨æˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸€ä¸‹Bridgicä¸­çš„å¹¶å‘æ¨¡å¼ (Concurrency Mode) è®¾è®¡ã€‚

é¦–å…ˆï¼ŒBridgicæ˜¯ä¸€ä¸ªä»¥å¼‚æ­¥ç¼–ç¨‹ä¸ºåŸºç¡€çš„æ¡†æ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯¹äºworkerçš„è°ƒåº¦æ‰§è¡Œï¼Œæ˜¯åŸºäºasyncioçš„ï¼Œæ¡†æ¶æœ¬èº«çš„è°ƒåº¦é€»è¾‘è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„event loopé‡Œé¢ã€‚é€šè¿‡å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œasyncioå¯¹äºasyncio-aware taskæ˜¯å¤©ç„¶å…·å¤‡å¹¶å‘æ‰§è¡Œèƒ½åŠ›çš„ã€‚ä½†æ˜¯ï¼Œå¯¹äºBlocking I/O taskå’ŒCPU-bound taskæ¥è¯´ï¼Œè¿™ä¸ªå¹¶å‘èƒ½åŠ›æ˜¯ä¸å¤Ÿçš„ï¼Œç†è®ºä¸Šåº”è¯¥ç”±å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹æ¥æä¾›ã€‚

æˆªæ­¢ç›®å‰ï¼ŒBridgicæ”¯æŒä¸¤ç§å¯¹äºworkerçš„è¿è¡Œæ¨¡å¼ï¼Œä¸€ç§æ˜¯å¼‚æ­¥çš„ï¼Œä¸€ç§æ˜¯åŒæ­¥çš„ã€‚å¯¹åº”çš„ï¼ŒBiridgicçš„`Worker`ç±»å®šä¹‰äº†ä¸¤ä¸ªå…¥å£æ–¹æ³•ï¼š

```
class Worker(Serializable):
    async def arun(self, *args: Tuple[Any, ...], **kwargs: Dict[str, Any]) -> Any:
        ...

    def run(self, *args: Tuple[Any, ...], **kwargs: Dict[str, Any]) -> Any:
        ...
```

å¦‚æœè¢«è°ƒåº¦çš„`Worker`å­ç±»å®ç°äº†`arun`å¼‚æ­¥æ–¹æ³•ï¼Œé‚£ä¹ˆBridgicå°±ä¼šä½¿ç”¨asyncioçš„æ–¹å¼ (`await`) æ¥è°ƒç”¨å®ƒï¼›ç›¸åï¼Œå¦‚æœè¢«è°ƒåº¦çš„`Worker`å­ç±»å®ç°äº†`run`åŒæ­¥æ–¹æ³•ï¼Œé‚£ä¹ˆBridgicå°±ä¼šä½¿ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼ï¼ˆå€ŸåŠ©asyncioçš„event loopæä¾›çš„`run_in_executor`æ–¹æ³•ï¼‰æ¥è°ƒç”¨å®ƒã€‚æ³¨æ„ï¼šé™äºå¼€å‘ä¸Šçš„ä¼˜å…ˆçº§æ’åºï¼ŒBridgicç›®å‰è¿˜æ²¡æœ‰æ”¯æŒå¤šè¿›ç¨‹çš„è°ƒç”¨æ–¹å¼ã€‚

æ ¹æ®[ä¹‹å‰çš„æ–‡ç« ](https://mp.weixin.qq.com/s/d2lADFG5m8pZ31v8epUhHQ)ä»‹ç»ï¼ŒBridgicå°†æ™ºèƒ½ä½“ä¸–ç•Œçš„ä¸‡äº‹ä¸‡ç‰©éƒ½å½’ç»“åˆ°äº†ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µä¹‹ä¸Šï¼Œä¸€ä¸ªå«workerï¼Œä¸€ä¸ªå«automaã€‚å…¶ä¸­workerè¿™ä¸ªæ¦‚å¿µå°±æ˜¯å‰é¢å®šä¹‰çš„`Worker`ç±»ã€‚ä¸ç®¡workerçš„è¡¨ç°å½¢å¼å¦‚ä½•ï¼Œæ¯”å¦‚å¯èƒ½æ˜¯ä¸ªå¯æ‰§è¡Œçš„functionï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸ªMCPè¡¨è¾¾çš„å·¥å…·ï¼Œå®ƒæœ€ç»ˆéƒ½ä¼šå½’ç»“åˆ°`Worker`çš„å­ç±»ä¸Šã€‚

ä¸¾ä¸ªä¾‹å­ï¼ˆç”±[ASL](https://mp.weixin.qq.com/s/D89UVC-0F0AGcjUbkdJjrw)è¡¨è¾¾ï¼‰ï¼š

```
async def worker_0():
    return ...
def worker_1(r0):
    return ...
def worker_2(r0):
    return ...
async def summary(r1, r2):
    return ...

class MyWorkflow(ASLAutoma):
    with graph as g:
        w0 = worker_0
        w1 = worker_1
        w2 = worker_2
        s = summary

        +w0 >> ( w1 & w2 ) >> ~s
```

ä½¿ç”¨`async def`å®šä¹‰çš„workerï¼Œæœ€ç»ˆä¼šç”±`Worker`å­ç±»çš„`arun`æ¥é©±åŠ¨ï¼›ä½¿ç”¨`def`å®šä¹‰çš„workerï¼Œæœ€ç»ˆä¼šç”±`Worker`å­ç±»çš„`run`æ¥é©±åŠ¨ã€‚å› æ­¤ï¼Œä¸Šè¿°ä»£ç æ‰§è¡Œæ—¶ï¼š

*   `worker_0`ä¼šå…ˆåœ¨ä¸»çº¿ç¨‹ä¸Šä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œã€‚
*   ç„¶å`worker_1`å’Œ`worker_2`ä¼šåœ¨æ–°çš„çº¿ç¨‹ä¸Šä»¥åŒæ­¥æ–¹å¼å¹¶å‘æ‰§è¡Œã€‚
*   æœ€ååœ¨`summary`æ‰§è¡Œæ—¶å†å›åˆ°ä¸»çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œã€‚

ç»“åˆå‰é¢ä¸¤ä¸ªå°èŠ‚è®¨è®ºçš„ä¸€äº›ç»“è®ºï¼Œå¯èƒ½åè¿‡æ¥é—®ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºagentçš„å¼€å‘è€…ä¼šæ›´æœ‰æŒ‡å¯¼æ„ä¹‰ï¼šåœ¨å®ç°workeræ—¶å€™ï¼Œä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨`async def`ï¼Œä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨`def`ï¼ˆå‰è€…å¯¹åº”`Worker.arun`ï¼Œåè€…å¯¹åº”`Worker.run`ï¼‰ï¼Ÿ

*   **å¯¹äºasyncio-aware taskï¼Œåº”è¯¥ä½¿ç”¨`async def`ã€‚**
*   **å¯¹äºBlocking I/O taskï¼Œåº”è¯¥ä½¿ç”¨`def`ã€‚**
*   **å¯¹äºCPU-bound taskï¼Œå½“å‰ä¹Ÿåº”è¯¥ä½¿ç”¨`def`ã€‚**è¿™è™½ç„¶ä¸æ˜¯çœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œï¼Œä½†è¿˜æ˜¯èƒ½å¤Ÿå®ç°å¤šä¸ªtaskåˆ†æ—¶å¤ç”¨ï¼Œä¸è‡³äºå®Œå…¨é˜»å¡ä½ã€‚æœªæ¥å¯èƒ½ä¼šåŸºäºfree threadingæˆ–è€…å¤šè¿›ç¨‹æ¥æä¾›çœŸæ­£çš„å¹¶è¡Œèƒ½åŠ›ã€‚

å°èŠ‚ä¸€ä¸‹ï¼šBridgicè°ƒåº¦å™¨çš„ã€Œåº•è‰²ã€æ˜¯åŸºäºasyncioçš„event loopçš„ã€‚æ¡†æ¶æœ¬èº«çš„è°ƒåº¦é€»è¾‘éƒ½æ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„event loopé‡Œï¼Œç„¶åä¸€ä¸ªèŠ‚æ‹ä¸€ä¸ªèŠ‚æ‹åœ°å»æ‰§è¡Œworkerã€‚åœ¨æ‰§è¡Œå…·ä½“æŸä¸ªworkerçš„æ—¶å€™ï¼Œæ ¹æ®workerçš„å®šä¹‰æ–¹å¼ï¼ˆæœ€ç»ˆå½’ç»“ä¸º`Worker`çš„`arun`è¿˜æ˜¯`run`ï¼‰æ¥å†³å®šæ˜¯ä½¿ç”¨asyncioæ¥æ‰§è¡Œï¼Œè¿˜æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹æ¥æ‰§è¡Œã€‚

### å¹¶å‘æ¨¡å¼å¯¹Bridgicæ¡†æ¶å±‚å®ç°çš„å½±å“

å°±åƒæœ¬æ–‡å¼€å¤´æ‰€è®²ï¼Œå¹¶å‘æ¨¡å¼æˆ–çº¿ç¨‹æ‰§è¡Œç¯å¢ƒæ˜¯ä¸€ä¸ªåŸºç¡€çš„ç¼–ç¨‹é—®é¢˜ï¼Œæ‰€ä»¥å…³äºå®ƒçš„è®¾è®¡ä¼šå½±å“åˆ°Bridgicæ¡†æ¶çš„å¾ˆå¤šæ–¹é¢ã€‚æœ€æ˜¾è‘—çš„ä¸€ä¸ªå½±å“åœ¨äºï¼šåœ¨workerçš„åŒæ­¥æ‰§è¡Œç¯å¢ƒï¼ˆ`Worker`çš„run`ï¼Œæˆ–è€…`def`å®šä¹‰çš„functionï¼‰ä¸­ï¼Œæ¡†æ¶æä¾›çš„å¼‚æ­¥APIå¦‚ä½•æš´éœ²ï¼Ÿ

ä¸¾ä¸ªä¾‹å­ï¼Œ`Automa`ç±»æœ‰ä¸€ä¸ªAPIï¼Œå«`request_feedback_async`ã€‚å®ƒæ˜¯ä¸ªå¼‚æ­¥çš„functionï¼Œç”¨äºå®ç°ç¬¬ä¸€ç§human-in-the-loopæ–¹æ¡ˆï¼ˆå…·ä½“å‚è§æ–‡ç« ã€Š[ä¸€æ–‡è®²é€AI Agentå¼€å‘ä¸­çš„human-in-the-loop](https://mp.weixin.qq.com/s/fNN32CGANMeAr_wlvhxtWA)ã€‹ï¼‰ã€‚è¿™ä¸ªAPIçš„å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```
async def request_feedback_async(
        self, 
        event: Event,
        timeout: Optional[float] = None
    ) -> Feedback:
        ...
```

æ˜¾ç„¶ï¼Œè¿™ä¸ªå‡½æ•°åœ¨åŒæ­¥çš„æ‰§è¡Œç¯å¢ƒä¸­æ˜¯ä¸èƒ½è°ƒç”¨çš„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸ºå®ƒå‡†å¤‡ä¸€ä¸ªåŒæ­¥çš„APIç‰ˆæœ¬ï¼š

```
def request_feedback(
        self, 
        event: Event,
        timeout: Optional[float] = None
    ) -> Feedback:
        ...
```

å‡è®¾æˆ‘ä»¬ç°åœ¨è¦å®ç°ä¸¤ä¸ªworkerï¼Œä»£ç ä¾‹å­å¦‚ä¸‹ï¼š

```
async def worker_0():
    ...
    feedback = await self.request_feedback_async(event)
    return feedback.data
def worker_1(r0):
    ...
    feedback = self.request_feedback(event)
    return feedback.data

class MyWorkflow(ASLAutoma):
    with graph as g:
        w0 = worker_0
        w1 = worker_1

        +w0 >> ~w1
```

åœ¨ä»¥ä¸Šè¿™æ®µä»£ç ç¤ºä¾‹ä¸­ï¼Œ`worker_0`æ˜¯å¼‚æ­¥çš„ï¼Œå®ƒåœ¨Bridgicçš„ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥è°ƒç”¨`request_feedback_async`ï¼›`worker_1`æ˜¯åŒæ­¥çš„ï¼Œå®ƒåœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥è°ƒç”¨`request_feedback`ï¼ˆæ— éœ€å†ä½¿ç”¨`await`ï¼‰ã€‚

ç”±äºåœ¨å¼‚æ­¥ç¯å¢ƒä¸­æ—¢å¯ä»¥è°ƒç”¨å¼‚æ­¥æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨åŒæ­¥æ–¹æ³•ï¼Œè€Œåœ¨åŒæ­¥ç¯å¢ƒä¸­åªèƒ½è°ƒç”¨åŒæ­¥æ–¹æ³•ï¼Œæ‰€ä»¥åªæœ‰workerå’Œautomaçš„å¼‚æ­¥APIæ‰éœ€è¦ç»´æŠ¤ä¸¤ä¸ªç‰ˆæœ¬ã€‚ç›¸åï¼ŒåŒæ­¥çš„APIï¼Œæ¯”å¦‚`ferry_to`ã€`add_worker`ã€`post_event`ç­‰ç­‰ï¼Œéƒ½åªéœ€è¦ç»´æŠ¤ä¸€ä¸ªç‰ˆæœ¬å³å¯ï¼ŒåŸºæœ¬ä¸Šä¸å—å¹¶å‘æ¨¡å¼çš„å½±å“ã€‚

è€Œå¯¹äºç±»ä¼¼`request_feedback_async`è¿™æ ·çš„å¼‚æ­¥APIï¼Œå¦‚ä½•æä¾›å®ƒçš„åŒæ­¥ç‰ˆæœ¬å‘¢ï¼Ÿæ˜¾ç„¶ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¿«é€Ÿé€‚é…ã€ä½æˆæœ¬çš„æ–¹æ¡ˆæ˜¯æœ€å¥½çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨Bridgicçš„æ¶æ„è®¾è®¡ä¸­ï¼Œè¿™æ ·çš„æ–¹æ³•æ˜¯å­˜åœ¨çš„ï¼è¿™æ˜¯å› ä¸ºï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒBridgicè°ƒåº¦å™¨çš„ã€Œåº•è‰²ã€æ˜¯åŸºäºasyncioçš„event loopï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå¹¶å‘æ¨¡å¼åªæ˜¯ä¼¸å±•å‡ºå»çš„æå¶ã€‚æ‰€ä»¥ï¼Œå…¶å®`request_feedback`å†…éƒ¨çš„å®ç°æ˜¯é€šè¿‡ç®€å•å°è£…`request_feedback_async`æ¥å®ç°çš„ã€‚å…·ä½“å®ç°ä»£ç å¾ˆçŸ­ï¼Œå¦‚ä¸‹ï¼š

```
def request_feedback(
        self, 
        event: Event,
        timeout: Optional[float] = None
    ) -> Feedback:
        if threading.get_ident() == self._main_thread_id:
            raise AutomaRuntimeError(
                f"`request_feedback` should only be called in a different thread from the main thread of the {self.name}. "
            )
        return asyncio.run_coroutine_threadsafe(
            self.request_feedback_async(event, timeout),
            self._main_loop
        ).result()
```

æ€»ä¹‹ï¼Œå¹¶å‘æ‰§è¡Œç¯å¢ƒæ˜¯ä¸€ä¸ªagentæ¡†æ¶é‡è¦çš„éåŠŸèƒ½æ€§éœ€æ±‚ä¹‹ä¸€ã€‚æ‰€æœ‰è¿™äº›ç»†èŠ‚ï¼Œå†åŠ ä¸Šå¯è§‚æµ‹æ€§ã€human-in-the-loopã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ç­‰èƒ½åŠ›ï¼Œéƒ½å·²ç»ç”±æ¡†æ¶æä¾›å¥½äº†ï¼Œagentå¼€å‘è€…æ— éœ€å†ä¸ºè¿™äº›åŸºç¡€æ€§é—®é¢˜ä¼¤é€è„‘ç­‹ã€‚è¿™ä¹Ÿæ˜¯å¼€å‘agentä¹‹æ‰€ä»¥éœ€è¦ä½¿ç”¨æ¡†æ¶çš„ä¸€ä¸ªåŸå› ã€‚

### æºç ä¸‹è½½

> [Bridgicæºç åœ°å€ âœ https://github.com/bitsky-tech/bridgic](https://github.com/bitsky-tech/bridgic)
> 
> [Automaç±»çš„å®ç°ä»£ç ï¼ˆå†…å«`request_feedback`çš„å®ç°ï¼‰ âœ https://github.com/bitsky-tech/bridgic/blob/main/packages/bridgic-core/bridgic/core/automa/_automa.py](https://github.com/bitsky-tech/bridgic/blob/main/packages/bridgic-core/bridgic/core/automa/_automa.py)
> 
> [Bridgicæ–‡æ¡£åœ°å€ âœ https://docs.bridgic.ai/](https://docs.bridgic.ai/)
> 
> [ASLæ•™ç¨‹åœ°å€ âœ https://docs.bridgic.ai/latest/tutorials/items/asl/quick_start/](https://docs.bridgic.ai/latest/tutorials/items/asl/quick_start/)

### åŠ å…¥æŠ€æœ¯äº¤æµç¾¤

æˆ‘å»ºäº†ä¸€ä¸ªâ€œBridgicå¼€æºæŠ€æœ¯äº¤æµç¾¤â€ï¼Œåé¢ä¼šåœ¨ç¾¤é‡Œå‘å¸ƒé¡¹ç›®çš„å¼€å‘è¿›å±•åŠè®¡åˆ’ï¼Œå¹¶è®¨è®ºç›¸å…³æŠ€æœ¯ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥æ‰«æä¸‹é¢çš„äºŒç»´ç è¿›ç¾¤ã€‚å¦‚æœäºŒç»´ç è¿‡æœŸï¼Œè¯·åŠ å¾®ä¿¡ID: zhtieleiï¼Œå¤‡æ³¨â€œæ¥è‡ªBridgicç¤¾åŒºâ€ã€‚

[![Image 2: BridgicæŠ€æœ¯äº¤æµç¾¤äºŒç»´ç ](https://zhangtielei.com/assets/bridgic_group_chat_qr_code.png)](https://zhangtielei.com/assets/bridgic_group_chat_qr_code.png)

ï¼ˆæ­£æ–‡å®Œï¼‰

##### å‚è€ƒæ–‡çŒ®ï¼š

*   [1] From Wikipedia. [MECE principle](https://en.wikipedia.org/wiki/MECE_principle).
*   [2] James Weaver. [Python Asyncio Part 5 â€“ Mixing Synchronous and Asynchronous Code](https://bbc.github.io/cloudfit-public-docs/asyncio/asyncio-part-5).
*   [3] Python Documentation. [asyncio â€” Asynchronous I/O](https://docs.python.org/3/library/asyncio.html).
*   [4] Python Documentation. [threading â€” Thread-based parallelism](https://docs.python.org/3/library/threading.html).
*   [5] Python Documentation. [Python support for free threading](https://docs.python.org/3/howto/free-threading-python.html).
*   [6] Python Documentation. [multiprocessing â€” Process-based parallelism](https://docs.python.org/3/library/multiprocessing.html).

**å…¶å®ƒç²¾é€‰æ–‡ç« **ï¼š

*   [åŸºäºåŠ¨æ€æ‹“æ‰‘çš„Agentç¼–æ’ï¼ŒåŸç†è§£æ+æºç ä¸‹è½½](https://mp.weixin.qq.com/s/FNAS-xp1RYAQfZj2nXLSCg)
*   [ã€å¼€æºã€‘æ™ºèƒ½ä½“ç¼–ç¨‹è¯­è¨€ASLâ€”â€”é‡æ„æ™ºèƒ½ä½“å¼€å‘ä½“éªŒ](https://mp.weixin.qq.com/s/D89UVC-0F0AGcjUbkdJjrw)
*   [ã€å¼€æºã€‘æˆ‘äº²æ‰‹å¼€å‘çš„ä¸€ä¸ªAIæ¡†æ¶ï¼Œè°ˆä¸‹èƒŒåçš„æ€è€ƒ](https://mp.weixin.qq.com/s/d2lADFG5m8pZ31v8epUhHQ)
*   [ä¸€æ–‡è®²é€AI Agentå¼€å‘ä¸­çš„human-in-the-loop](https://mp.weixin.qq.com/s/fNN32CGANMeAr_wlvhxtWA)
*   [AI Agentæ—¶ä»£çš„è½¯ä»¶å¼€å‘èŒƒå¼](https://mp.weixin.qq.com/s/vejqEv5hACcbT15b4Xe5LQ)
*   [AI Agentçš„æ¦‚å¿µã€è‡ªä¸»ç¨‹åº¦å’ŒæŠ½è±¡å±‚æ¬¡](https://mp.weixin.qq.com/s/dJAWleHyOWd8FPqH5ZqDWw)
*   [æŠ€æœ¯å˜è¿ä¸­çš„å˜ä¸ä¸å˜ï¼šå¦‚ä½•æ›´å¿«åœ°ç”Ÿæˆtokenï¼Ÿ](https://mp.weixin.qq.com/s/BPnX0zOJr8PLAxlvKQBsxw)
*   [ç§‘æ™®ä¸€ä¸‹ï¼šæ‹†è§£LLMèƒŒåçš„æ¦‚ç‡å­¦åŸç†](https://mp.weixin.qq.com/s/gF-EAVn0sfaPgvHmRLW3Gw)
*   [åˆ†å¸ƒå¼é¢†åŸŸæœ€é‡è¦çš„ä¸€ç¯‡è®ºæ–‡ï¼Œåˆ°åº•è®²äº†ä»€ä¹ˆï¼Ÿ](https://mp.weixin.qq.com/s/FZnJLPeTh-bV0amLO5CnoQ)

**åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œå¹¶åŒ…å«ä¸‹é¢çš„äºŒç»´ç ï¼å¦åˆ™æ‹’ç»è½¬è½½ï¼**

**æœ¬æ–‡é“¾æ¥ï¼š**[http://zhangtielei.com/posts/blog-bridgic-concurrency-mode.html](http://zhangtielei.com/posts/blog-bridgic-concurrency-mode.html)

**æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®åšï¼šå¾®åšä¸Šæœç´¢æˆ‘çš„åå­—ã€Œå¼ é“è•¾ã€ã€‚**

![Image 3: æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·: tielei-blog (å¼ é“è•¾)](https://zhangtielei.com/assets/my_weixin_sign_sf_840.jpg)

* * *